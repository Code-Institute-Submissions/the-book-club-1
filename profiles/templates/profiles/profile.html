{% extends "base.html" %} {% load static %} {% block extra_css %}
<link rel="stylesheet" href="{% static 'profiles/css/profile.css' %}" />
{% endblock %} {% block content %}
<button onclick="topFunction()" id="backToTopBtn" title="Back to top">
Top
</button>
<div class="overlay"></div>
<div class="container header-container">
   <div class="row align-center">
      <div class="col">
         <h2 class="mb-4">Your Profile</h2>
      </div>
   </div>
</div>
<!-- Order History -->
<div class="container-fluid mb-3" id="order_history"></div>
<div class="row">
   <div class="col mb-2">
      <h3>Order History</h3>
   </div>
</div>
{% if orders %}
<!-- Grid view for small screens -->
<!-- <div class="row order-history-small">
   {% for order in orders %}
   <div class="card">
     <div class="col"><p>Date: {{ order.date }}</p></div>
     <div class="col">
       <p>
         Order Number:
         <a
           href="{% url 'order_history' order.order_number %}"
           title="{{ order.order_number }}"
         >
           {{ order.order_number|truncatechars:6 }}
         </a>
       </p>
       <div class="col"><p>Order Total: €{{ order.order_total }}</p></div>
     </div>
     {% endfor %}
   </div> -->
<div class="row">
   <div class="col">
      <!-- Table for medium and large screens -->
      <div class="table-responsive-md">
         <table class="table">
            <thead>
               <tr class="orange-background">
                  <th>Order Number</th>
                  <th>Date</th>
                  <th>Items</th>
                  <th>Order Total</th>
               </tr>
            </thead>
            <tbody>
               {% for order in orders %}
               <tr>
                  <td>
                     <a
                        href="{% url 'order_history' order.order_number %}"
                        title="{{ order.order_number }}"
                        >
                     {{ order.order_number|truncatechars:6 }}
                     </a>
                  </td>
                  <td>{{ order.date }}</td>
                  <td>
                     <ul class="list-unstyled">
                        {% for item in order.lineitems.all %}
                        <li class="small">
                           {% if item.book != None %}
                           <p >
                              <strong>"{{ item.book.title }}"</strong> (book)
                              <br>
                              <a
                                 class="p-1 mt-1 border"
                                 href="{% url 'write_review' item.book.id %}"
                                 >Review Book</a
                                 >
                              {% else %}
                           </p>
                           <p>
                              <strong> "{{ item.plan.name }}"</strong> (plan)
                                                            <br>

                              <a
                                 class="p-1 mt-2 border"
                                 data-toggle="collapse"
                                 href="#collapsePlanBooks{{item.plan.id}}"
                                 role="button"
                                 aria-expanded="false"
                                 aria-controls="collapsePlanBooks{{item.plan.id}}"
                                 >
                              Plan Details
                              </a>
                           </p>
                           <!--  Collapsable to display the books in each plan-->
                           <div
                              class="collapse"
                              id="collapsePlanBooks{{item.plan.id}}"
                              >
                              <div class="card card-body">
                                 <ul class="list-unstyled">
                                    {% for book in item.plan.books.all %}
                                    <li>
                                       <p>
                                          <strong>{{ book.title }}</strong>
                                          <a
                                             class="p-1 mt-1 border"
                                             href="{% url 'write_review' book.id %}"
                                             >Review Book</a
                                             >
                                       </p>
                                    </li>
                                    {% endfor %}
                                 </ul>
                              </div>
                           </div>
                           {% endif %}
                        </li>
                        {% endfor %}
                     </ul>
                  </td>
                  <td>€{{ order.order_total }}</td>
               </tr>
               {% endfor %}
            </tbody>
         </table>
      </div>
   </div>
</div>
{% else %}
<div class="row">
   <div class="col">
      <p>You don't have any orders.</p>
   </div>
</div>
{% endif %}
<hr />
<!-- Delivery Information -->
<div class="container-fluid" id="details">
   <div class="row margin-top-3">
      <div class="col-12 col-sm-8">
         <h3>Default Delivery Information</h3>
      </div>
      <div class="col-12 col-sm-4 align-center">
         <a
            class="btn"
            data-toggle="collapse"
            href="#collapseDeliveryInfo"
            role="button"
            aria-expanded="false"
            aria-controls="collapseExample"
            >
         Review Delivery Details
         </a>
      </div>
      <div class="col-12 col-md-6 collapse" id="collapseDeliveryInfo">
         <form
            class="mt-3"
            action="{% url 'profile' %}"
            method="POST"
            id="profile-update-form"
            >
            {% csrf_token %} {{ form|crispy }}
            <button class="btn float-right">
            Update
            </button>
         </form>
      </div>
   </div>
</div>
<hr />
<!-- Reviews -->
<div class="container-fluid margin-botton-5" id="reviews">
   <div class="row">
      <div class="col">
         <h3>Your Reviews</h3>
      </div>
   </div>
   {% if reviews %}
   <div class="row">
      <div class="col">
         {% for review in reviews %}
         <div class="card reviews-card">
            <div class="card-title card-title-reviews">
               <h5>The book you reviewed:<strong>"{{ review.book }}"</strong></h5>
               <h5><strong>"{{ review.title }}"</strong></h5>
               <h5><strong>{{ review.rating }} / 5 </strong></h5>
            </div>
            <div class="card-body">
               <p class="font-italic">{{ review.date }}</p>
               <p>{{ review.review_text }}</p>
               <a
                  class="btn btn-small delete-review-btn"
                  href="{% url 'delete_review' review.id %}"
                  >Delete Review</a
                  >
            </div>
         </div>
         {% endfor %}
      </div>
   </div>
   {% else %}
   <div class="row">
      <div class="col">
         <h3>Reviews</h3>
         <p>You haven't reviewed any books yet.</p>
      </div>
   </div>
</div>
{% endif %} {% endblock %} {% block postloadjs %} {{ block.super }}
<script
   type="text/javascript"
   src="{% static 'profiles/js/countryfield.js' %}"
   ></script>
{% endblock %}
</div>